<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…å§å§å°ä¸ä»£ç æ˜¾ç¤ºå±èƒŒæ™¯</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0a0a1a;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        /* èƒŒæ™¯ä»£ç æ˜¾ç¤ºå± */
        .code-display {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #0f0;
            text-shadow: 0 0 8px #0f0, 0 0 16px #0f0;
            overflow: hidden;
            animation: screenFlicker 0.2s infinite linear;
            /* åƒç´ é£æ•ˆæœ */
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            /* å…‰æ …æ•ˆæœ */
            background-image: 
                linear-gradient(90deg, transparent 98%, rgba(0, 255, 0, 0.03) 100%),
                linear-gradient(0deg, transparent 98%, rgba(0, 255, 0, 0.03) 100%);
            background-size: 2px 2px;
            /* GPUåŠ é€Ÿ */
            transform: translateZ(0);
            will-change: transform;
        }
        
        /* è¾¹æ¡†å±‚ - æœ€é¡¶å±‚ */
        .border-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            pointer-events: none;
            /* èµ›åšæœ‹å…‹è§å…‰è¾¹æ¡†æ•ˆæœ */
            border: 8px solid #00ffff;
            box-shadow: 
                inset 0 0 0 4px #ff00ff,
                0 0 10px #00ffff,
                0 0 20px #00ffff,
                0 0 30px #00ffff,
                0 0 40px #00ffff,
                inset 0 0 10px #ff00ff,
                inset 0 0 20px #ff00ff,
                0 0 50px rgba(0, 255, 255, 0.8),
                0 0 80px rgba(255, 0, 255, 0.6);
            animation: neonGlow 2s ease-in-out infinite alternate;
        }
        
        .code-line {
            margin-bottom: 8px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .code-char {
            display: inline-block;
            animation: charFlicker 1s infinite ease-in-out;
            animation-delay: calc(var(--char-index) * 0.1s);
            /* åƒç´ é£å­—ç¬¦æ•ˆæœ */
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            /* å­—ç¬¦åƒç´ åŒ– */
            transform: scale(1);
            filter: contrast(1.2) brightness(1.1);
            will-change: opacity, filter;
        }
        
        
        @keyframes charFlicker {
            0%, 100% { 
                opacity: 1; 
                text-shadow: 0 0 8px #0f0, 0 0 16px #0f0;
                filter: contrast(1.2) brightness(1.1);
                transform: scale(1);
            }
            25% { 
                opacity: 0.3; 
                text-shadow: 0 0 4px #0f0;
                filter: contrast(0.8) brightness(0.8);
                transform: scale(0.98);
            }
            50% { 
                opacity: 0.8; 
                text-shadow: 0 0 12px #0f0, 0 0 20px #0f0;
                filter: contrast(1.5) brightness(1.3);
                transform: scale(1.02);
            }
            75% { 
                opacity: 0.5; 
                text-shadow: 0 0 6px #0f0;
                filter: contrast(1.0) brightness(0.9);
                transform: scale(0.99);
            }
        }
        
        
        @keyframes screenFlicker {
            0%, 100% { opacity: 1; }
            99% { opacity: 0.98; }
        }
        
        /* å…‰æ …æ‰«æçº¿æ•ˆæœ */
        .code-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                0deg,
                transparent 0%,
                rgba(0, 255, 0, 0.1) 1px,
                transparent 2px,
                transparent 100%
            );
            background-size: 100% 3px;
            animation: scanlineMove 0.1s linear infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        /* åƒç´ ç½‘æ ¼æ•ˆæœ */
        .code-display::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 0, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 0, 0.1) 1px, transparent 1px);
            background-size: 8px 8px;
            animation: pixelGrid 2s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes scanlineMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(3px); }
        }
        
        @keyframes pixelGrid {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.1; }
        }
        
        @keyframes neonGlow {
            0% {
                border-color: #00ffff;
                box-shadow: 
                    inset 0 0 0 4px #ff00ff,
                    0 0 10px #00ffff,
                    0 0 20px #00ffff,
                    0 0 30px #00ffff,
                    0 0 40px #00ffff,
                    inset 0 0 10px #ff00ff,
                    inset 0 0 20px #ff00ff,
                    0 0 50px rgba(0, 255, 255, 0.8),
                    0 0 80px rgba(255, 0, 255, 0.6);
            }
            50% {
                border-color: #00ccff;
                box-shadow: 
                    inset 0 0 0 4px #ff33ff,
                    0 0 15px #00ccff,
                    0 0 30px #00ccff,
                    0 0 45px #00ccff,
                    0 0 60px #00ccff,
                    inset 0 0 15px #ff33ff,
                    inset 0 0 30px #ff33ff,
                    0 0 70px rgba(0, 204, 255, 1),
                    0 0 100px rgba(255, 51, 255, 0.8);
            }
            100% {
                border-color: #0099ff;
                box-shadow: 
                    inset 0 0 0 4px #ff66ff,
                    0 0 20px #0099ff,
                    0 0 40px #0099ff,
                    0 0 60px #0099ff,
                    0 0 80px #0099ff,
                    inset 0 0 20px #ff66ff,
                    inset 0 0 40px #ff66ff,
                    0 0 90px rgba(0, 153, 255, 1.2),
                    0 0 120px rgba(255, 102, 255, 1);
            }
        }
        
        @keyframes scrollUp {
            0% { transform: translateY(100%); }
            100% { transform: translateY(-100%); }
        }
        
        .scrolling-line {
            animation: scrollUp 3s linear infinite;
            animation-delay: calc(var(--line-index) * 0.2s);
        }
        
        /* å§å°å‰æ™¯ */
        .bar-foreground {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-top: 200px;
            pointer-events: none;
        }
        
        /* å§å°å…‰æ …æ•ˆæœå±‚ */
        .bar-foreground::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(90deg, transparent 98%, rgba(255, 255, 255, 0.08) 100%),
                linear-gradient(0deg, transparent 98%, rgba(255, 255, 255, 0.08) 100%);
            background-size: 3px 3px;
            background-repeat: repeat;
            pointer-events: none;
            z-index: 1;
        }
        
        .bar-foreground * {
            pointer-events: auto;
        }
        
        /* å¯¹è¯ç³»ç»Ÿæ ·å¼ */
        .dialogue-container {
            position: absolute;
            top: 70px;
            left: 700px;
            z-index: 50;
            pointer-events: auto;
            max-height: 200px;
        }
        
        .dialogue-bubble {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: 12px 16px;
            margin-bottom: 10px;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            box-shadow: 
                0 0 15px rgba(0, 255, 255, 0.5),
                inset 0 0 8px rgba(0, 255, 255, 0.1);
            animation: bubbleGlow 2s ease-in-out infinite alternate;
            max-width: 60%;
            word-wrap: break-word;
        }
        
        .dialogue-bubble.stella {
            margin-left: 0;
            margin-right: auto;
            border-color: #ff00ff;
            box-shadow: 
                0 0 15px rgba(255, 0, 255, 0.5),
                inset 0 0 8px rgba(255, 0, 255, 0.1);
            max-width: 50%;
        }
        
        .dialogue-bubble.user {
            margin-left: auto;
            background: rgba(0, 20, 40, 0.9);
            border-color: #00ff88;
            box-shadow: 
                0 0 20px rgba(0, 255, 136, 0.5),
                inset 0 0 10px rgba(0, 255, 136, 0.1);
        }
        
        .speaker-name {
            color: #00ffff;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #00ffff;
        }
        
        .speaker-name.stella {
            color: #ff00ff;
            text-shadow: 0 0 5px #ff00ff;
        }
        
        .speaker-name.user {
            color: #00ff88;
            text-shadow: 0 0 5px #00ff88;
        }
        
        .choice-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .choice-btn {
            background: linear-gradient(45deg, #00ffff, #0088ff);
            border: 2px solid #00ffff;
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.15s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
            will-change: transform, box-shadow, background;
        }
        
        .choice-btn:hover {
            background: linear-gradient(45deg, #00ff88, #00cc66);
            border-color: #00ff88;
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.6);
            transform: translateY(-2px);
        }
        
        .choice-btn:active {
            transform: translateY(0);
        }
        
        .recording-btn {
            background: linear-gradient(45deg, #ff0088, #ff4488);
            border: 2px solid #ff00ff;
            color: #fff;
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 0 20px rgba(255, 0, 136, 0.5);
            margin: 10px 0;
        }
        
        .recording-btn:hover {
            background: linear-gradient(45deg, #ff4488, #ff88aa);
            box-shadow: 0 0 30px rgba(255, 0, 136, 0.8);
            transform: scale(1.05);
        }
        
        .recording-btn.recording {
            background: linear-gradient(45deg, #ff4444, #ff8888);
            animation: recordingPulse 1s ease-in-out infinite;
        }
        
        @keyframes bubbleGlow {
            0% { box-shadow: 0 0 20px rgba(0, 255, 255, 0.3), inset 0 0 10px rgba(0, 255, 255, 0.1); }
            100% { box-shadow: 0 0 30px rgba(0, 255, 255, 0.6), inset 0 0 15px rgba(0, 255, 255, 0.2); }
        }
        
        @keyframes recordingPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .hidden {
            display: none;
        }
        
        .click-to-continue {
            position: absolute;
            bottom: 10px;
            right: 15px;
            color: #00ffff;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            animation: clickPulse 1.5s ease-in-out infinite;
            pointer-events: none;
            z-index: 10;
        }
        
        .dialogue-bubble {
            position: relative;
            cursor: pointer;
        }
        
        @keyframes clickPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }
        
        .bar-counter {
            width: 100%;
            height: 400px;
            /* é»˜è®¤æ ·å¼ä½œä¸ºåå¤‡ */
            background: linear-gradient(to bottom, #3a2c1a, #1a1208);
            border-radius: 0;
            position: relative;
        }
        
        /* å½“æœ‰å›¾ç‰‡æ—¶è¦†ç›–é»˜è®¤æ ·å¼ */
        .bar-counter.has-image {
            background-image: url('bar-counter.png');
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center;
            background: url('bar-counter.png') center/cover no-repeat;
        }
        
        
        .bartender {
            position: absolute;
            bottom: 170px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            height: 650px;
            z-index: 15;
            /* é»˜è®¤é€æ˜èƒŒæ™¯ */
            background-color: transparent;
        }
        
        /* å½“æœ‰å›¾ç‰‡æ—¶æ˜¾ç¤ºå›¾ç‰‡ */
        .bartender.has-image {
            background-image: url('bartender.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
        }
        
        /* å½“æœ‰å›¾ç‰‡æ—¶éšè—ä¼ªå…ƒç´  */
        .bartender.has-image::before,
        .bartender.has-image::after {
            display: none;
        }
        
        .bartender::before {
            content: '';
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background-color: #f5d7b4;
            border-radius: 50%;
        }
        
        .bartender::after {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 50px;
            background-color: #222;
            border-radius: 50px 50px 0 0;
        }
        
        
        
    </style>
</head>
<body>
    
    <div class="container">
        <!-- èƒŒæ™¯ä»£ç æ˜¾ç¤ºå± -->
        <div class="code-display" id="codeDisplay">
            <!-- ä»£ç å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- å‰æ™¯å§å° -->
        <div class="bar-foreground">
            <div class="bartender"></div>
            <div class="bar-counter"></div>
        </div>
        
        <!-- å¯¹è¯ç³»ç»Ÿ -->
        <div class="dialogue-container" id="dialogueContainer">
            <!-- å¯¹è¯å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>
    
        <!-- è¾¹æ¡†å±‚ - æœ€é¡¶å±‚ -->
        <div class="border-overlay"></div>
    </div>
    

    <script>
        // ä¸“ä¸šçš„ä»£ç æ¨¡æ¿ - å¸¦ç¼©è¿›å’Œç»“æ„
        const codeTemplates = [
            '// ========================================',
            '// ä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„ - ç”¨æˆ·ç®¡ç†æ¨¡å—',
            '// ========================================',
            '',
            'import { Logger, Database, Redis } from \'@core/services\';',
            'import { UserEntity, UserRole } from \'@entities/user\';',
            'import { ValidationError, BusinessError } from \'@exceptions\';',
            '',
            '/**',
            ' * ç”¨æˆ·è®¤è¯æœåŠ¡ç±»',
            ' * @class AuthenticationService',
            ' */',
            'export class AuthenticationService {',
            '    private readonly logger: Logger;',
            '    private readonly db: Database;',
            '    private readonly redis: Redis;',
            '',
            '    constructor(dependencies: ServiceDependencies) {',
            '        this.logger = dependencies.logger;',
            '        this.db = dependencies.database;',
            '        this.redis = dependencies.redis;',
            '    }',
            '',
            '    /**',
            '     * ç”¨æˆ·ç™»å½•è®¤è¯',
            '     * @param credentials ç”¨æˆ·å‡­æ®',
            '     * @returns Promise<AuthResult>',
            '     */',
            '    async authenticateUser(credentials: LoginCredentials): Promise<AuthResult> {',
            '        try {',
            '            const { username, password } = credentials;',
            '            ',
            '            // å‚æ•°éªŒè¯',
            '            if (!username || !password) {',
            '                throw new ValidationError(\'ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º\');',
            '            }',
            '            ',
            '            // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯',
            '            const user = await this.db.query(',
            '                \'SELECT * FROM users WHERE username = ?\',',
            '                [username]',
            '            );',
            '            ',
            '            if (!user) {',
            '                throw new BusinessError(\'ç”¨æˆ·ä¸å­˜åœ¨\');',
            '            }',
            '            ',
            '            // éªŒè¯å¯†ç ',
            '            const isValidPassword = await bcrypt.compare(password, user.passwordHash);',
            '            if (!isValidPassword) {',
            '                throw new BusinessError(\'å¯†ç é”™è¯¯\');',
            '            }',
            '            ',
            '            // ç”ŸæˆJWTä»¤ç‰Œ',
            '            const token = this.generateJWTToken(user);',
            '            ',
            '            // ç¼“å­˜ç”¨æˆ·ä¼šè¯',
            '            await this.redis.setex(`session:${user.id}`, 3600, token);',
            '            ',
            '            this.logger.info(`ç”¨æˆ· ${username} ç™»å½•æˆåŠŸ`);',
            '            ',
            '            return {',
            '                success: true,',
            '                token,',
            '                user: this.sanitizeUser(user)',
            '            };',
            '        } catch (error) {',
            '            this.logger.error(\'ç”¨æˆ·è®¤è¯å¤±è´¥:\', error);',
            '            throw error;',
            '        }',
            '    }',
            '',
            '    /**',
            '     * ç”ŸæˆJWTä»¤ç‰Œ',
            '     * @private',
            '     */',
            '    private generateJWTToken(user: UserEntity): string {',
            '        const payload = {',
            '            userId: user.id,',
            '            username: user.username,',
            '            role: user.role,',
            '            iat: Math.floor(Date.now() / 1000),',
            '            exp: Math.floor(Date.now() / 1000) + (24 * 60 * 60) // 24å°æ—¶',
            '        };',
            '        ',
            '        return jwt.sign(payload, process.env.JWT_SECRET!);',
            '    }',
            '}',
            '',
            '/**',
            ' * ç”¨æˆ·ç®¡ç†æœåŠ¡ç±»',
            ' * @class UserManagementService',
            ' */',
            'export class UserManagementService {',
            '    private readonly logger: Logger;',
            '    private readonly db: Database;',
            '',
            '    constructor(dependencies: ServiceDependencies) {',
            '        this.logger = dependencies.logger;',
            '        this.db = dependencies.database;',
            '    }',
            '',
            '    /**',
            '     * åˆ›å»ºæ–°ç”¨æˆ·',
            '     * @param userData ç”¨æˆ·æ•°æ®',
            '     * @returns Promise<UserEntity>',
            '     */',
            '    async createUser(userData: CreateUserRequest): Promise<UserEntity> {',
            '        const transaction = await this.db.beginTransaction();',
            '        ',
            '        try {',
            '            // æ•°æ®éªŒè¯',
            '            await this.validateUserData(userData);',
            '            ',
            '            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨',
            '            const existingUser = await this.db.query(',
            '                \'SELECT id FROM users WHERE email = ?\',',
            '                [userData.email]',
            '            );',
            '            ',
            '            if (existingUser) {',
            '                throw new BusinessError(`é‚®ç®± ${userData.email} å·²è¢«æ³¨å†Œ`);',
            '            }',
            '            ',
            '            // åŠ å¯†å¯†ç ',
            '            const passwordHash = await bcrypt.hash(userData.password, 12);',
            '            ',
            '            // åˆ›å»ºç”¨æˆ·è®°å½•',
            '            const userId = await this.db.query(',
            '                `INSERT INTO users (username, email, password_hash, role, created_at) ',
            '                 VALUES (?, ?, ?, ?, NOW())`,',
            '                [',
            '                    userData.username,',
            '                    userData.email,',
            '                    passwordHash,',
            '                    userData.role || UserRole.USER',
            '                ]',
            '            );',
            '            ',
            '            await transaction.commit();',
            '            ',
            '            this.logger.info(`ç”¨æˆ·åˆ›å»ºæˆåŠŸ: ${userData.email}`);',
            '            ',
            '            return await this.getUserById(userId);',
            '        } catch (error) {',
            '            await transaction.rollback();',
            '            this.logger.error(\'ç”¨æˆ·åˆ›å»ºå¤±è´¥:\', error);',
            '            throw error;',
            '        }',
            '    }',
            '}',
            '',
            '// ========================================',
            '// æ•°æ®åº“è¿æ¥é…ç½®',
            '// ========================================',
            '',
            'interface DatabaseConfig {',
            '    host: string;',
            '    port: number;',
            '    username: string;',
            '    password: string;',
            '    database: string;',
            '    pool: {',
            '        min: number;',
            '        max: number;',
            '        acquireTimeoutMillis: number;',
            '        idleTimeoutMillis: number;',
            '    };',
            '}',
            '',
            'const dbConfig: DatabaseConfig = {',
            '    host: process.env.DB_HOST || \'localhost\',',
            '    port: parseInt(process.env.DB_PORT || \'5432\'),',
            '    username: process.env.DB_USERNAME || \'postgres\',',
            '    password: process.env.DB_PASSWORD || \'\',',
            '    database: process.env.DB_NAME || \'app_db\',',
            '    pool: {',
            '        min: 2,',
            '        max: 10,',
            '        acquireTimeoutMillis: 30000,',
            '        idleTimeoutMillis: 30000,',
            '    },',
            '};',
            '',
            '// ========================================',
            '// å·¥å…·å‡½æ•°å’Œä¸­é—´ä»¶',
            '// ========================================',
            '',
            '/**',
            ' * è¯·æ±‚æ—¥å¿—ä¸­é—´ä»¶',
            ' */',
            'export const requestLogger = (req: Request, res: Response, next: NextFunction) => {',
            '    const startTime = Date.now();',
            '    ',
            '    res.on(\'finish\', () => {',
            '        const duration = Date.now() - startTime;',
            '        logger.info(`${req.method} ${req.path} - ${res.statusCode} - ${duration}ms`);',
            '    });',
            '    ',
            '    next();',
            '};',
            '',
            '/**',
            ' * é”™è¯¯å¤„ç†ä¸­é—´ä»¶',
            ' */',
            'export const errorHandler = (',
            '    error: Error,',
            '    req: Request,',
            '    res: Response,',
            '    next: NextFunction',
            ') => {',
            '    logger.error(\'Unhandled error:\', error);',
            '    ',
            '    if (error instanceof ValidationError) {',
            '        return res.status(400).json({',
            '            error: \'VALIDATION_ERROR\',',
            '            message: error.message,',
            '        });',
            '    }',
            '    ',
            '    if (error instanceof BusinessError) {',
            '        return res.status(409).json({',
            '            error: \'BUSINESS_ERROR\',',
            '            message: error.message,',
            '        });',
            '    }',
            '    ',
            '    res.status(500).json({',
            '        error: \'INTERNAL_SERVER_ERROR\',',
            '        message: \'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\',',
            '    });',
            '};'
        ];
        
        // ç”Ÿæˆéšæœºä»£ç è¡Œ - é•¿çŸ­å‚å·®ä¸é½
        function generateCodeLines(count) {
            const lines = [];
            const templates = [...codeTemplates];
            
            for (let i = 0; i < count; i++) {
                if (templates.length > 0) {
                    lines.push(templates[i % templates.length]);
                } else {
                    // ç”Ÿæˆéšæœºä»£ç  - åˆ›å»ºé•¿çŸ­ä¸ä¸€çš„æ•ˆæœ
                    const keywords = ['function', 'const', 'let', 'var', 'if', 'else', 'for', 'while', 'return', 'class', 'async', 'await', 'try', 'catch', 'finally'];
                    const symbols = ['{', '}', '(', ')', '[', ']', ';', '=', '+', '-', '*', '/', '=>', '...', '&&', '||', '!==', '==='];
                    const variables = ['x', 'y', 'z', 'i', 'j', 'k', 'count', 'index', 'data', 'result', 'item', 'user', 'config', 'response', 'error'];
                    const strings = ['"Hello World"', '"Error occurred"', "'user data'", '`template string`', '"API response"'];
                    
                let line = '';
                    // åˆ›å»ºæ›´æç«¯çš„é•¿åº¦å·®å¼‚ï¼šçŸ­è¡Œ(5-15å­—ç¬¦) å’Œ é•¿è¡Œ(30-80å­—ç¬¦)
                    const isShortLine = Math.random() < 0.4; // 40%æ¦‚ç‡ç”ŸæˆçŸ­è¡Œ
                    const lineLength = isShortLine ? 
                        Math.floor(Math.random() * 10) + 5 : 
                        Math.floor(Math.random() * 50) + 30;
                
                for (let j = 0; j < lineLength; j++) {
                    const randomType = Math.random();
                    
                        if (randomType < 0.25) {
                        // å…³é”®å­—
                        line += keywords[Math.floor(Math.random() * keywords.length)] + ' ';
                        } else if (randomType < 0.5) {
                        // å˜é‡
                        line += variables[Math.floor(Math.random() * variables.length)] + ' ';
                        } else if (randomType < 0.7) {
                        // ç¬¦å·
                        line += symbols[Math.floor(Math.random() * symbols.length)] + ' ';
                        } else {
                            // å­—ç¬¦ä¸²
                            line += strings[Math.floor(Math.random() * strings.length)] + ' ';
                    }
                }
                
                    lines.push(line.trim());
                }
            }
            
            return lines;
        }
        
        // åˆ›å»ºä»£ç è¡Œ
        function createCodeLine(text, lineIndex) {
            const codeLine = document.createElement('div');
            codeLine.className = 'code-line scrolling-line';
            codeLine.style.setProperty('--line-index', lineIndex);
            
            // é€ä¸ªå­—ç¬¦åˆ›å»º
            for (let i = 0; i < text.length; i++) {
                const charSpan = document.createElement('span');
                charSpan.className = 'code-char';
                charSpan.textContent = text[i];
                charSpan.style.setProperty('--char-index', i);
                codeLine.appendChild(charSpan);
            }
            
            return codeLine;
        }
        
        // å¡«å……ä»£ç æ˜¾ç¤ºå±
        function populateCodeDisplay() {
            const codeDisplay = document.getElementById('codeDisplay');
            const lines = generateCodeLines(80); // å¢åŠ æ›´å¤šè¡Œæ•°ä»¥æ˜¾ç¤ºå‚å·®æ•ˆæœ
            
            lines.forEach((line, index) => {
                const codeLine = createCodeLine(line, index);
                codeDisplay.appendChild(codeLine);
            });
        }
        
        // åŠ¨æ€æ·»åŠ æ–°ä»£ç è¡Œ
        function addNewCodeLine() {
            const codeDisplay = document.getElementById('codeDisplay');
            const lines = generateCodeLines(1);
            const newLine = createCodeLine(lines[0], codeDisplay.children.length);
            
            codeDisplay.appendChild(newLine);
            
            // ç§»é™¤æœ€æ—§çš„è¡Œä»¥ä¿æŒæ€§èƒ½
            if (codeDisplay.children.length > 100) {
                codeDisplay.removeChild(codeDisplay.firstChild);
            }
        }
        
        // æ£€æµ‹å›¾ç‰‡æ˜¯å¦å­˜åœ¨å¹¶åˆ‡æ¢æ ·å¼
        function checkImageExists(imagePath, element, className) {
            const img = new Image();
            img.onload = function() {
                element.classList.add(className);
                console.log(`âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ: ${imagePath}`);
            };
            img.onerror = function() {
                element.classList.remove(className);
                console.log(`âŒ å›¾ç‰‡åŠ è½½å¤±è´¥: ${imagePath}`);
            };
            img.src = imagePath;
        }
        
        // åˆå§‹åŒ–
        populateCodeDisplay();
        
        // æ£€æµ‹è°ƒé…’å¸ˆå›¾ç‰‡
        const bartender = document.querySelector('.bartender');
        checkImageExists('bartender.png', bartender, 'has-image');
        
        // æ£€æµ‹å§å°å›¾ç‰‡
        const barCounter = document.querySelector('.bar-counter');
        checkImageExists('bar-counter.png', barCounter, 'has-image');
        
        // å®šæœŸæ·»åŠ æ–°ä»£ç è¡Œ - ä¼˜åŒ–é¢‘ç‡
        setInterval(addNewCodeLine, 4000);
        
        // éšæœºæ”¹å˜å­—ç¬¦é¢œè‰² - ä¼˜åŒ–æ€§èƒ½
        setInterval(() => {
            const chars = document.querySelectorAll('.code-char');
            // åªæ”¹å˜å°‘é‡å­—ç¬¦ï¼Œå‡å°‘é‡ç»˜
            const sampleSize = Math.min(chars.length, 8);
            for (let i = 0; i < sampleSize; i++) {
                const randomIndex = Math.floor(Math.random() * chars.length);
                if (Math.random() < 0.05) {
                    chars[randomIndex].style.color = Math.random() < 0.5 ? '#0f0' : '#0ff';
                }
            }
        }, 4000);
        
        // å¯¹è¯ç³»ç»Ÿ
        class DialogueSystem {
            constructor() {
                this.container = document.getElementById('dialogueContainer');
                this.currentStep = 0;
                this.userChoices = {
                    melody: null,
                    style: null,
                    mbti: null
                };
                this.dialogueQueue = [];
                this.isWaitingForClick = false;
                this.init();
            }
            
            init() {
                this.showWelcome();
            }
            
            showWelcome() {
                this.dialogueQueue = [
                    { speaker: 'stella', name: 'Stella', text: 'æ™šä¸Šå¥½ï¼Œä¸€ä½æ–°å®¢äººã€‚æ¬¢è¿æ¥åˆ°ã€Œæ—‹å¾‹é…¿é€ å‚ã€ï¼Œä¸€ä¸ªèƒ½ç”¨å£°éŸ³è°ƒåˆ¶é¸¡å°¾é…’çš„åœ°æ–¹ã€‚æˆ‘æ˜¯è¿™é‡Œçš„è°ƒé…’å¸ˆï¼ŒStellaã€‚çœ‹èµ·æ¥ï¼Œæ‚¨æƒ³å°è¯•ä¸€æ¯ç‰¹è°ƒçš„"å£°éŸ³é¸¡å°¾é…’"ï¼Ÿ', showClick: true },
                    { action: 'choices', choices: ['å¼€å§‹è°ƒåˆ¶', 'äº†è§£æ›´å¤š'] }
                ];
                this.processNextDialogue();
            }
            
            processNextDialogue() {
                if (this.dialogueQueue.length === 0) return;
                
                const next = this.dialogueQueue.shift();
                
                if (next.action === 'choices') {
                    this.addChoiceButtons(next.choices);
                } else if (next.action === 'recording') {
                    this.addRecordingButton();
                } else if (next.action === 'next_step') {
                    this[next.step]();
                } else {
                    this.addBubble(next.speaker, next.name, next.text, next.showClick);
                }
            }
            
            addBubble(speaker, name, text, showClickHint = true) {
                // æ¸…é™¤ä¹‹å‰çš„å¯¹è¯æ°”æ³¡
                this.clearBubbles();
                
                const bubble = document.createElement('div');
                bubble.className = `dialogue-bubble ${speaker}`;
                bubble.innerHTML = `
                    <div class="speaker-name ${speaker}">${name}</div>
                    <div>${text}</div>
                    ${showClickHint ? '<div class="click-to-continue">ç‚¹å‡»ç»§ç»­...</div>' : ''}
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                if (showClickHint) {
                    bubble.addEventListener('click', () => {
                        this.handleBubbleClick();
                    });
                }
                
                this.container.appendChild(bubble);
                this.scrollToBottom();
                this.isWaitingForClick = showClickHint;
            }
            
            handleBubbleClick() {
                if (this.isWaitingForClick) {
                    this.isWaitingForClick = false;
                    this.processNextDialogue();
                }
            }
            
            addChoiceButtons(choices) {
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'choice-buttons';
                
                choices.forEach(choice => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = choice;
                    button.onclick = () => this.handleChoice(choice);
                    buttonContainer.appendChild(button);
                });
                
                this.container.appendChild(buttonContainer);
                this.scrollToBottom();
            }
            
            addRecordingButton() {
                const button = document.createElement('button');
                button.className = 'recording-btn';
                button.textContent = 'ğŸ¤ å¼€å§‹å½•åˆ¶';
                button.onclick = () => this.startRecording();
                this.container.appendChild(button);
                this.scrollToBottom();
            }
            
            handleChoice(choice) {
                this.clearChoices();
                
                switch(choice) {
                    case 'å¼€å§‹è°ƒåˆ¶':
                        this.step1_BaseMelody();
                        break;
                    case 'äº†è§£æ›´å¤š':
                        this.addBubble('stella', 'Stella', 'ã€Œæ—‹å¾‹é…¿é€ å‚ã€æ˜¯ä¸€ä¸ªç¥å¥‡çš„åœ°æ–¹ï¼Œåœ¨è¿™é‡Œï¼Œæ‚¨çš„æ­Œå£°ä¼šå˜æˆè°ƒé…’çš„åŸæ–™ã€‚æ¯ä¸€æ®µæ—‹å¾‹éƒ½æœ‰å®ƒç‹¬ç‰¹çš„"å‘³é“"ï¼Œè€Œæˆ‘çš„å·¥ä½œå°±æ˜¯å°†è¿™äº›"å‘³é“"èåˆæˆä¸€æ¯å®Œç¾çš„éŸ³ä¹é¸¡å°¾é…’ã€‚');
                        this.addChoiceButtons(['å¬èµ·æ¥å¾ˆæœ‰è¶£ï¼Œå¼€å§‹å§ï¼']);
                        break;
                    case 'å¬èµ·æ¥å¾ˆæœ‰è¶£ï¼Œå¼€å§‹å§ï¼':
                        this.step1_BaseMelody();
                        break;
                    case 'çˆµå£«':
                    case 'ç”µå­':
                    case 'å¤å…¸':
                    case 'æµè¡Œ':
                    case 'Lo-fi':
                    case 'æ‘‡æ»š':
                        this.userChoices.style = choice;
                        this.step3_Personality();
                        break;
                    case 'Iå‹ï¼ˆå†…å‘ï¼‰':
                        this.userChoices.mbti = 'I';
                        this.askMBTI_N();
                        break;
                    case 'Eå‹ï¼ˆå¤–å‘ï¼‰':
                        this.userChoices.mbti = 'E';
                        this.askMBTI_N();
                        break;
                    case 'Nå‹ï¼ˆç›´è§‰ï¼‰':
                        this.userChoices.mbti += 'N';
                        this.askMBTI_F();
                        break;
                    case 'Så‹ï¼ˆæ„Ÿè§‰ï¼‰':
                        this.userChoices.mbti += 'S';
                        this.askMBTI_F();
                        break;
                    case 'Få‹ï¼ˆæƒ…æ„Ÿï¼‰':
                        this.userChoices.mbti += 'F';
                        this.askMBTI_J();
                        break;
                    case 'Tå‹ï¼ˆæ€è€ƒï¼‰':
                        this.userChoices.mbti += 'T';
                        this.askMBTI_J();
                        break;
                    case 'Jå‹ï¼ˆåˆ¤æ–­ï¼‰':
                        this.userChoices.mbti += 'J';
                        this.finalStep();
                        break;
                    case 'På‹ï¼ˆæ„ŸçŸ¥ï¼‰':
                        this.userChoices.mbti += 'P';
                        this.finalStep();
                        break;
                    case 'å¼€å§‹å½•åˆ¶':
                        this.startRecording();
                        break;
                    case 'é‡æ–°è°ƒåˆ¶':
                        // é‡ç½®ç”¨æˆ·é€‰æ‹©
                        this.userChoices = {
                            melody: null,
                            style: null,
                            mbti: null
                        };
                        // é‡æ–°å¼€å§‹å¯¹è¯
                        this.showWelcome();
                        break;
                    case 'ç»“æŸå¯¹è¯':
                        this.addBubble('stella', 'Stella', 'æ„Ÿè°¢æ‚¨çš„å…‰ä¸´ï¼æœŸå¾…ä¸‹æ¬¡å†è§ã€‚', false);
                        break;
                }
            }
            
            step1_BaseMelody() {
                this.dialogueQueue = [
                    { speaker: 'stella', name: 'Stella', text: 'å¤ªå¥½äº†ã€‚æˆ‘çš„å·¥ä½œï¼Œå°±æ˜¯å°†æ‚¨å¸¦æ¥çš„ç‹¬ç‰¹"åŸæ–™"ï¼Œèåˆæˆä¸€æ¯åªå±äºæ‚¨çš„éŸ³ä¹ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼Ÿé¦–å…ˆï¼Œæˆ‘éœ€è¦æ‚¨æä¾›ä¸‰ç§æ ¸å¿ƒçš„"åŸºé…’"å’Œ"é£å‘³"ã€‚', showClick: true },
                    { speaker: 'stella', name: 'Stella', text: 'æ¯ä¸€æ¯ç»å…¸çš„é¸¡å°¾é…’ï¼Œéƒ½ç¦»ä¸å¼€ä¸€ä»½ä¼˜è´¨çš„"åŸºé…’"ã€‚è¯·æ‚¨ä¸ºæˆ‘"å“¼å”±"ä¸€æ®µæ—‹å¾‹å§ï¼Œæ— è®ºæ˜¯ä¸€æ®µç†Ÿæ‚‰çš„å‰¯æ­Œï¼Œè¿˜æ˜¯æ‚¨è„‘æµ·ä¸­çªç„¶é—ªè¿‡çš„çµæ„Ÿç‰‡æ®µéƒ½å¯ä»¥ã€‚å®ƒå°†æ˜¯è¿™æ¯éŸ³ä¹æœ€åŸå§‹çš„åº•è‰²ã€‚', showClick: true },
                    { action: 'recording' }
                ];
                this.processNextDialogue();
            }
            
            startRecording() {
                const button = document.querySelector('.recording-btn');
                if (button) {
                    button.textContent = 'â¹ï¸ åœæ­¢å½•åˆ¶';
                    button.classList.add('recording');
                    
                    // ä¿®æ”¹æŒ‰é’®ç‚¹å‡»äº‹ä»¶ä¸ºåœæ­¢å½•åˆ¶
                    button.onclick = () => this.stopRecording();
                }
            }
            
            stopRecording() {
                const button = document.querySelector('.recording-btn');
                if (button) {
                    button.textContent = 'âœ… å½•åˆ¶å®Œæˆ';
                    button.classList.remove('recording');
                    
                    // æ¢å¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                    button.onclick = () => this.startRecording();
                    
                    setTimeout(() => {
                        this.step1_Complete();
                    }, 1000);
                }
            }
            
            step1_Complete() {
                // æ¸…é™¤å½•åˆ¶æŒ‰é’®
                this.clearChoices();
                
                this.dialogueQueue = [
                    { speaker: 'stella', name: 'Stella', text: 'å—¯â€¦â€¦æˆ‘æ”¶åˆ°äº†ï¼Œä¸€æ®µéå¸¸çµåŠ¨çš„æ—‹å¾‹ã€‚å¾ˆå¥½çš„å¼€ç«¯ï¼Œè¿™ç“¶"åŸºé…’"æ½œåŠ›æ— ç©·ã€‚', showClick: true },
                    { speaker: 'stella', name: 'Stella', text: 'åŸºé…’å·²å¤‡ï¼Œæ¥ä¸‹æ¥æ˜¯å†³å®šé£å‘³çš„æ—¶å€™äº†ã€‚æ‚¨å¸Œæœ›æ‚¨çš„è¿™æ¯éŸ³ä¹ï¼Œæ˜¯å“ªç§"å£æ„Ÿ"å‘¢ï¼Ÿ', showClick: true },
                    { action: 'next_step', step: 'step2_Style' }
                ];
                this.processNextDialogue();
            }
            
            step2_Style() {
                this.dialogueQueue = [
                    { speaker: 'stella', name: 'Stella', text: 'æ˜¯æƒ³æ¥ç‚¹çˆµå£«çš„å¾®é†ºä¸æš§æ˜§ï¼Œåƒä¸€æ¯Old Fashionedï¼Ÿè¿˜æ˜¯ç”µå­éŸ³ä¹çš„å†°å‡‰ä¸ç‚¸è£‚ï¼Œå¦‚åŒä¸€æ¯Mojitoï¼Ÿæˆ–è€…ï¼Œæ‚¨åçˆ±å¤å…¸çš„é†‡åšä¸å¤æ‚ï¼Œåƒä¸€æ¯å±‚æ¬¡ä¸°å¯Œçš„Manhattanï¼Ÿè¯·å‘Šè¯‰æˆ‘æ‚¨çš„é€‰æ‹©ã€‚', showClick: true },
                    { action: 'choices', choices: ['çˆµå£«', 'ç”µå­', 'å¤å…¸', 'æµè¡Œ', 'Lo-fi', 'æ‘‡æ»š'] }
                ];
                this.processNextDialogue();
            }
            
            step3_Personality() {
                this.dialogueQueue = [
                    { speaker: 'stella', name: 'Stella', text: `æ˜æ™ºä¹‹é€‰ã€‚${this.userChoices.style}çš„é£å‘³ï¼Œæ€»èƒ½å¸¦æ¥æ„æƒ³ä¸åˆ°çš„æƒŠå–œã€‚æˆ‘å·²ç»èƒ½æƒ³è±¡å®ƒå’Œæ‚¨çš„æ—‹å¾‹èåˆåçš„æ ·å­äº†ã€‚`, showClick: true },
                    { speaker: 'stella', name: 'Stella', text: 'æœ€åï¼Œä¹Ÿæ˜¯æˆ‘æœ€å¼•ä»¥ä¸ºå‚²çš„ç¯èŠ‚â€”â€”æ³¨å…¥ä¸€ä¸æ‚¨çš„ä¸ªäººè‰²å½©ã€‚è¿™å°±åƒé¸¡å°¾é…’é‡Œé‚£æ»´ç¥ç§˜çš„"è‹¦ç²¾"ï¼Œçœ‹ä¼¼å¾®ä¸è¶³é“ï¼Œå´èƒ½è®©æ•´æ¯é…’æ‹¥æœ‰ç‹¬ä¸€æ— äºŒçš„çµé­‚ã€‚', showClick: true },
                    { action: 'next_step', step: 'askMBTI_I' }
                ];
                this.processNextDialogue();
            }
            
            askMBTI_I() {
                this.addBubble('stella', 'Stella', 'æ‚¨æ˜¯iäººè¿˜æ˜¯eäººï¼Ÿ', false);
                this.addChoiceButtons(['Iå‹ï¼ˆå†…å‘ï¼‰', 'Eå‹ï¼ˆå¤–å‘ï¼‰']);
            }
            
            askMBTI_N() {
                this.addBubble('stella', 'Stella', 'æ‚¨æ˜¯näººè¿˜æ˜¯säººï¼Ÿ', false);
                this.addChoiceButtons(['Nå‹ï¼ˆç›´è§‰ï¼‰', 'Så‹ï¼ˆæ„Ÿè§‰ï¼‰']);
            }
            
            askMBTI_F() {
                this.addBubble('stella', 'Stella', 'æ‚¨æ˜¯fäººè¿˜æ˜¯täººï¼Ÿ', false);
                this.addChoiceButtons(['Få‹ï¼ˆæƒ…æ„Ÿï¼‰', 'Tå‹ï¼ˆæ€è€ƒï¼‰']);
            }
            
            askMBTI_J() {
                this.addBubble('stella', 'Stella', 'æ‚¨æ˜¯jäººè¿˜æ˜¯päººï¼Ÿ', false);
                this.addChoiceButtons(['Jå‹ï¼ˆåˆ¤æ–­ï¼‰', 'På‹ï¼ˆæ„ŸçŸ¥ï¼‰']);
            }
            
            addMBTIChoices() {
                const mbtiTypes = [
                    'INTJ', 'INTP', 'ENTJ', 'ENTP',
                    'INFJ', 'INFP', 'ENFJ', 'ENFP',
                    'ISTJ', 'ISFJ', 'ESTJ', 'ESFJ',
                    'ISTP', 'ISFP', 'ESTP', 'ESFP'
                ];
                
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'choice-buttons';
                
                // æ˜¾ç¤ºå‰8ä¸ªç±»å‹
                mbtiTypes.slice(0, 8).forEach(type => {
                    const button = document.createElement('button');
                    button.className = 'choice-btn';
                    button.textContent = type;
                    button.onclick = () => this.handleMBTIChoice(type);
                    buttonContainer.appendChild(button);
                });
                
                this.container.appendChild(buttonContainer);
                this.scrollToBottom();
            }
            
            handleMBTIChoice(mbti) {
                this.userChoices.mbti = mbti;
                this.clearChoices();
                this.finalStep();
            }
            
            finalStep() {
                this.addBubble('stella', 'Stella', `ï¼ˆçœ¼ç¥ä¸­é—ªè¿‡ä¸€ä¸äº†ç„¶ï¼‰å•Šï¼ŒåŸæ¥æ˜¯${this.userChoices.mbti}ã€‚æˆ‘æ˜ç™½äº†ã€‚è¿™ç“¶"ç§˜æ–™"ä¼šè®©æœ€ç»ˆçš„ä½œå“æ›´åŠ è´´åˆæ‚¨çš„æ°”è´¨ã€‚æ„Ÿè°¢æ‚¨çš„åˆ†äº«ã€‚`);
                setTimeout(() => {
                    this.addBubble('stella', 'Stella', 'å®Œç¾ï¼æ‰€æœ‰çš„åŸæ–™éƒ½å·²é›†é½ã€‚\næ‚¨çš„ä¸ªäººæ—‹å¾‹â€”â€”æˆ‘ä»¬çš„ç”Ÿå‘½ä¹‹æ°´ã€‚\n' + this.userChoices.style + 'â€”â€”æˆ‘ä»¬çš„é£å‘³åˆ©å£é…’ã€‚\nè¿˜æœ‰' + this.userChoices.mbti + 'çš„äººæ ¼ç‰¹è´¨â€”â€”é‚£ç‚¹ç›ä¹‹ç¬”çš„çµé­‚ç§˜æ–™ã€‚');
                    setTimeout(() => {
                        this.addBubble('stella', 'Stella', 'ç°åœ¨ï¼Œè¯·ç¨åç‰‡åˆ»ï¼Œè®©æˆ‘ä¸ºæ‚¨ç°åœº"è°ƒåˆ¶"ã€‚è¿™éœ€è¦ä¸€ç‚¹é­”æ³•å’Œæ—¶é—´ã€‚');
                        this.showMixingAnimation();
                    }, 2000);
                }, 2000);
            }
            
            showMixingAnimation() {
                const mixingBubble = document.createElement('div');
                mixingBubble.className = 'dialogue-bubble stella';
                mixingBubble.innerHTML = `
                    <div class="speaker-name stella">Stella</div>
                    <div>ğŸ”® æ­£åœ¨ç”Ÿæˆæ‚¨çš„éŸ³ä¹é¸¡å°¾é…’â€¦</div>
                    <div style="margin-top: 10px; font-size: 14px; color: #ff00ff;">
                        âœ¨ è°ƒåˆ¶ä¸­... âœ¨ èåˆæ—‹å¾‹... âœ¨ æ³¨å…¥é£æ ¼... âœ¨ æ·»åŠ äººæ ¼ç‰¹è´¨...
                    </div>
                `;
                this.container.appendChild(mixingBubble);
                this.scrollToBottom();
                
                // æ¨¡æ‹Ÿè°ƒåˆ¶è¿‡ç¨‹
                setTimeout(() => {
                    this.showFinalResult();
                }, 5000);
            }
            
            showFinalResult() {
                const drinkNames = {
                    'INTJ': 'INTJçš„æœˆå…‰å°å¤œæ›²',
                    'INTP': 'INTPçš„ç”µè·¯æ¡‘æ ¼åˆ©äºš',
                    'ENTJ': 'ENTJçš„ç‹è€…é©¬æå°¼',
                    'ENTP': 'ENTPçš„ç”µè·¯æ¡‘æ ¼åˆ©äºš',
                    'INFJ': 'INFJçš„æœˆå…‰å°å¤œæ›²',
                    'INFP': 'INFPçš„æ¢¦å¹»è«å‰æ‰˜',
                    'ENFJ': 'ENFJçš„æ¸©æš–å¨å£«å¿Œ',
                    'ENFP': 'ENFPçš„æ´»åŠ›æœ—å§†é…’'
                };
                
                const drinkName = drinkNames[this.userChoices.mbti] || `${this.userChoices.mbti}çš„ç‰¹è°ƒé¸¡å°¾é…’`;
                
                this.addBubble('stella', 'Stella', `ï¼ˆå°†ä¸€æ¯æ³›ç€å¾®å…‰ã€ä»¿ä½›æœ‰éŸ³ç¬¦åœ¨æµåŠ¨çš„"è™šæ‹Ÿé¸¡å°¾é…’"æ¨åˆ°ç”¨æˆ·é¢å‰ï¼‰æ‚¨çš„ç‰¹è°ƒï¼Œã€Œ${drinkName}ã€ï¼Œå®Œæˆäº†ã€‚`);
                setTimeout(() => {
                    this.addBubble('stella', 'Stella', 'è¯·æˆ´ä¸Šè€³æœºï¼Œç»†ç»†å“å‘³ã€‚å¸Œæœ›è¿™æ¯ç”±æ‚¨äº²è‡ªå‚ä¸é…¿é€ çš„å£°éŸ³ï¼Œèƒ½å¸¦ç»™æ‚¨ä¸€æ®µç¾å¦™çš„æ—¶å…‰ã€‚å¦‚æœå–œæ¬¢ï¼Œéšæ—¶å¯ä»¥å›æ¥ï¼Œæˆ‘ä»¬å†æ¢ä¸€ç§é…æ–¹ã€‚');
                    this.addChoiceButtons(['é‡æ–°è°ƒåˆ¶', 'ç»“æŸå¯¹è¯']);
                }, 2000);
            }
            
            clearBubbles() {
                const bubbles = this.container.querySelectorAll('.dialogue-bubble');
                bubbles.forEach(bubble => bubble.remove());
            }
            
            clearChoices() {
                const buttons = this.container.querySelectorAll('.choice-buttons, .recording-btn');
                buttons.forEach(btn => btn.remove());
            }
            
            scrollToBottom() {
                this.container.scrollTop = this.container.scrollHeight;
            }
        }
        
        // åˆå§‹åŒ–å¯¹è¯ç³»ç»Ÿ
        const dialogueSystem = new DialogueSystem();
    </script>
</body>
</html>